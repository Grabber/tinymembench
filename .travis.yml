language: c

matrix:
  include:
    - os: linux
      compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - llvm-toolchain-precise-3.8
          packages:
            - g++-4.9
            - clang-format-3.8
      script:
        - make

    - os: linux
      compiler: arm-linux-gnueabihf-gcc
      addons:
        apt:
          packages:
            - gcc-arm-linux-gnueabihf
            - libc6-dev-armhf-cross
            - qemu-user
      script:
        - CFLAGS="-O2 -g -static -DMAXREPEATS=1 -DLATBENCH_COUNT=1000" make
        - qemu-arm ./tinymembench

    - os: linux
      dist: trusty
      compiler: aarch64-linux-gnu-gcc
      addons:
        apt:
          packages:
            - gcc-aarch64-linux-gnu
            - libc6-dev-arm64-cross
            - qemu-user
      script:
        - CFLAGS="-O2 -g -static -DMAXREPEATS=1 -DLATBENCH_COUNT=1000" make
        - qemu-aarch64 ./tinymembench

    - os: linux
      dist: trusty
      compiler: i586-mingw32msvc-gcc
      addons:
        apt:
          packages:
            - mingw32
            - mingw32-binutils
            - mingw32-runtime
            - wine
      script:
        - CFLAGS="-O2 -g -DMAXREPEATS=1 -DLATBENCH_COUNT=1000" make
        - i586-mingw32msvc-objdump -d ./tinymembench
        - wine ./tinymembench

    - os: linux
      compiler: x86_64-w64-mingw32-gcc
      addons:
        apt:
          packages:
            - gcc-mingw-w64-base
            - binutils-mingw-w64-i686
            - gcc-mingw-w64-i686
            - gcc-mingw-w64
            - wine
      script:
        - CFLAGS="-O2 -g -DMAXREPEATS=1 -DLATBENCH_COUNT=1000" make
        - wine ./tinymembench
        - make clean
        - CFLAGS="-O2 -m32 -g -DMAXREPEATS=1 -DLATBENCH_COUNT=1000" make
        - wine ./tinymembench
